<!DOCTYPE html>
<html lang="en">
<head>
	<!--pjax: don't stop the music-->
  <script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.js"></script>
  
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Merriweather:300,300italic,400,400italic,700,700italic|Syne+Mono:300,300italic,400,400italic,700,700italic|Abril+Fatface:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.1/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"rdweirdo981.github.io","root":"/","images":"/images","scheme":"Pisces","version":"8.1.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"gitalk","storage":true,"lazyload":false,"nav":null,"activeClass":"gitalk"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}};
  </script>
<meta name="description" content="This is a continuous challenge. The first 2 challenges are in 0CTF 2021 Finals ezRSA ezRSA+. I&#39;ll walkthrough all these three challenges and see the connection between them. ezRSA Challenge 1234567891">
<meta property="og:type" content="article">
<meta property="og:title" content="TCTF&#x2F;0CTF 2022 Crypto ezRSA&#x2F;ezRSA+&#x2F;ezRSA++">
<meta property="og:url" content="https://rdweirdo981.github.io/2023/02/20/CTF/0CTF22_ezRSA/index.html">
<meta property="og:site_name" content="Life φlosophy">
<meta property="og:description" content="This is a continuous challenge. The first 2 challenges are in 0CTF 2021 Finals ezRSA ezRSA+. I&#39;ll walkthrough all these three challenges and see the connection between them. ezRSA Challenge 1234567891">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2023-02-19T17:17:46.000Z">
<meta property="article:modified_time" content="2023-02-19T17:18:53.267Z">
<meta property="article:author" content="Daisy">
<meta property="article:tag" content="CTF">
<meta property="article:tag" content="Cryptography">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://rdweirdo981.github.io/2023/02/20/CTF/0CTF22_ezRSA/">


<script data-pjax class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>
<title>TCTF/0CTF 2022 Crypto ezRSA/ezRSA+/ezRSA++ | Life φlosophy</title>
  



  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>


<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Life φlosophy</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li>
        <li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
        <li class="menu-item menu-item-collection"><a href="/collection/" rel="section"><i class="fa fa-globe fa-fw"></i>Resources</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
		<iframe src="https://open.spotify.com/embed/track/5Q777K2mEK7lxZHROGIZrt?utm_source=generator" width="100%" height="80" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"></iframe>
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <section class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#ezrsa"><span class="nav-number">1.</span> <span class="nav-text">ezRSA</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#challenge"><span class="nav-number">1.1.</span> <span class="nav-text">Challenge</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#solution"><span class="nav-number">1.2.</span> <span class="nav-text">Solution</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#code"><span class="nav-number">1.2.1.</span> <span class="nav-text">Code</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#reference"><span class="nav-number">1.3.</span> <span class="nav-text">Reference</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ezrsa-1"><span class="nav-number">2.</span> <span class="nav-text">ezRSA+</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#challenge-1"><span class="nav-number">2.1.</span> <span class="nav-text">Challenge</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#solution-1"><span class="nav-number">2.2.</span> <span class="nav-text">Solution</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#code-1"><span class="nav-number">2.2.1.</span> <span class="nav-text">Code</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#reference-1"><span class="nav-number">2.3.</span> <span class="nav-text">Reference</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ezrsa-2"><span class="nav-number">3.</span> <span class="nav-text">ezRSA++</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#challenge-2"><span class="nav-number">3.1.</span> <span class="nav-text">Challenge</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#solution-2"><span class="nav-number">3.2.</span> <span class="nav-text">Solution</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#code-2"><span class="nav-number">3.2.1.</span> <span class="nav-text">Code</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#reference-2"><span class="nav-number">3.3.</span> <span class="nav-text">Reference</span></a></li></ol></li></ol></div>
        </section>
        <!--/noindex-->

        <section class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Daisy"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">Daisy</p>
  <div class="site-description" itemprop="description">Cryptography | Mathematics | InfoSec | etc.</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">27</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">15</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">37</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



        </section>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://rdweirdo981.github.io/2023/02/20/CTF/0CTF22_ezRSA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Daisy">
      <meta itemprop="description" content="Cryptography | Mathematics | InfoSec | etc.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Life φlosophy">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          TCTF/0CTF 2022 Crypto ezRSA/ezRSA+/ezRSA++
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2023-02-20 01:17:46 / Modified: 01:18:53" itemprop="dateCreated datePublished" datetime="2023-02-20T01:17:46+08:00">2023-02-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/3-Catch-The-Flag/" itemprop="url" rel="index"><span itemprop="name">3. Catch The Flag</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/3-Catch-The-Flag/CTF-Crypto/" itemprop="url" rel="index"><span itemprop="name">CTF-Crypto</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>This is a continuous challenge. The first 2 challenges are in 0CTF
2021 Finals <a target="_blank" rel="noopener" href="https://github.com/M0urn3r/My-Public-CTF-Challenges#ezRSA+">ezRSA</a>
<a target="_blank" rel="noopener" href="https://github.com/M0urn3r/My-Public-CTF-Challenges#ezRSA+">ezRSA+</a>.</p>
<p>I'll walkthrough all these three challenges and see the connection
between them.</p>
<h2 id="ezrsa">ezRSA</h2>
<h3 id="challenge">Challenge</h3>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">from</span> os <span class="keyword">import</span> urandom</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gen</span>(<span class="params">n_size, m_size</span>):</span></span><br><span class="line">    alpha = <span class="number">0.5</span></span><br><span class="line">    delta = <span class="number">0.03</span></span><br><span class="line">    d_size = <span class="built_in">int</span>(delta * n_size)</span><br><span class="line">    k_size = <span class="built_in">int</span>((alpha + delta - <span class="number">0.5</span>) * n_size)</span><br><span class="line">    c_size = <span class="built_in">int</span>(n_size * (<span class="number">1</span> - alpha - <span class="number">2</span> * delta))</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            d_p = getRandomNBitInteger(d_size)</span><br><span class="line">            d_q = getRandomNBitInteger(d_size)</span><br><span class="line">            k = getRandomNBitInteger(k_size)</span><br><span class="line">            l = getRandomNBitInteger(k_size)</span><br><span class="line">            <span class="keyword">if</span> GCD(k ,l) == <span class="number">1</span> <span class="keyword">and</span> GCD(d_p, k) == <span class="number">1</span> <span class="keyword">and</span> GCD(d_q, l) == <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        e = inverse(d_p, k) * inverse(l, k) * l + inverse(d_q, l) * inverse(k, l) * k</span><br><span class="line">        c = getRandomNBitInteger(c_size)</span><br><span class="line">        e += c * k * l</span><br><span class="line">        <span class="keyword">assert</span> e * d_q % l == <span class="number">1</span></span><br><span class="line">        <span class="keyword">assert</span> e * d_p % k == <span class="number">1</span></span><br><span class="line">        p = (e * d_p - <span class="number">1</span>) // k + <span class="number">1</span></span><br><span class="line">        q = (e * d_q - <span class="number">1</span>) // l + <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> isPrime(p) <span class="keyword">and</span> isPrime(q):</span><br><span class="line">            magic = <span class="number">1337</span> * k ** <span class="number">4</span> + <span class="number">7331</span> * l ** <span class="number">3</span> + <span class="number">73331</span> * k ** <span class="number">2</span> + <span class="number">13337</span> * l ** <span class="number">2</span> + <span class="number">7</span> * k * l + <span class="number">2</span> * k + l</span><br><span class="line">            mask = <span class="number">2</span> ** m_size - <span class="number">1</span></span><br><span class="line">            <span class="keyword">return</span> (p * q, e), (d_p, d_q, p, q), (magic, d_p &amp; mask, d_q &amp; mask) </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span>(<span class="params">m, pk</span>):</span></span><br><span class="line">    n, e = pk</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">pow</span>(m, e, n)</span><br><span class="line"></span><br><span class="line">n_size = <span class="number">2000</span></span><br><span class="line">m_size = <span class="number">10</span></span><br><span class="line">pk, sk, hint = gen(n_size, m_size)</span><br><span class="line">flag = urandom(n_size // <span class="number">8</span> - <span class="built_in">len</span>(flag) - <span class="number">1</span>) + flag</span><br><span class="line">enc = encrypt(<span class="built_in">int</span>(flag.<span class="built_in">hex</span>(), <span class="number">16</span>), pk)</span><br><span class="line"></span><br><span class="line">print(pk)</span><br><span class="line">print(hint)</span><br><span class="line">print(enc)</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">(13144833961692953638155744717380612667335058302310815242506755676885208234342620331186804951145894484501542968789132832800279633590988848298405521677820600481054741175400784558190943019903268095468121342412114428860754522164657102624139527993254089574309927288457799155130004731846999722554981630609692264462023821778810225493633789543259034893395115658330417361250466876018981150507377427664192443342394808337473089411393262018525828475108149889915075872592673448211565529063972264324533136645650169687118301014325354524932405270872098633633071371124551496573869700120350489760340226474892703585296623, 4976865541630914024304930292600669330017247151290783019063407119314069119952298933566289617702551408322779629557316539138884407655160925920670189379289389411163083468782698396121446186733546486790309424372952321446384824084362527492399667929050403530173432700957192011119967010196844119305465574740437)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">(154118536863381755324327990994045278493514334577571515646858907141541837890, 431, 217)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">12075538182684677737023332074837542797880423774993595442794806087281173669267997104408555839686283996516133283992342507757326913240132429242004071236464149863112788729225204797295863969020348408992315952963166814392745345811848977394200562308125908479180595553832800151118160338048296786712765863667672764499042391263351628529676289293121487926074423104988380291130127694041802572569416584214743544288441507782008422389394379332477148914009173609753877263990429988651290402630935296993764147874437465394433756515223371180032964253037946818633821940103044535390973722964105390263537722948112571112911062</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="solution">Solution</h3>
<p>Let's look at the running part first. With
<code>n_size = 2000, m_size = 10</code>, <code>pk,sk,hint</code> are
generated by calling <code>gen(n_size, m_size)</code>. Thus, we look at
this function in details.</p>
<p>Part 1 Parameters: <span class="math display">\[
\begin{aligned}
\alpha &amp;= 0.5, \\
\delta &amp;= 0.03, \\
d_s &amp;= \delta \cdot n_s = 60, \\
k_s &amp;= (\alpha+\delta-0.5)\cdot n_s = 60, \\
c_s &amp;= n_s \cdot (1-\alpha-2\cdot \delta)=880.
\end{aligned}\]</span></p>
<p>Part 2 Condition on parameters: <span class="math inline">\(d_p,
d_q\)</span> are random <span class="math inline">\(d_s=60\)</span> bits
integer; <span class="math inline">\(k,l\)</span> are random <span class="math inline">\(k_s=60\)</span> bits integer. And we have the
constraint: <span class="math display">\[
\gcd(k,l) = \gcd(d_p,k) = \gcd(d_q,l)=1.
\]</span></p>
<p>Part 3 Condition on <span class="math inline">\(e\)</span>: observing
<code>line 19</code>, <span class="math inline">\(l\)</span> and <span class="math inline">\(k\)</span> are factors of two components in RHS
equation. Thus, we can actually <span class="math inline">\(\bmod
l\)</span> and <span class="math inline">\(\bmod k\)</span> to obtain
the condition on Chinese Remainder Theorem (CRT): <span class="math display">\[
\left\{
\begin{aligned}
e &amp;\equiv d_q^{-1} \bmod l\\
e &amp;\equiv d_p^{-1} \bmod k
\end{aligned}
\right.
\]</span> <span class="math inline">\(c\)</span> is a random <span class="math inline">\(c_s = 880\)</span> bits integer (very large). And
<span class="math inline">\(e = e + ckl\)</span>. (will not change the
property of <span class="math inline">\(\bmod l\)</span> or <span class="math inline">\(\bmod k\)</span>.)</p>
<div id="pq">

</div>
<p>Then calculate <span class="math inline">\(p,q\)</span> as below:
<span class="math display">\[
\begin{aligned}
p &amp;= \lfloor\frac{e\cdot d_p - 1}{k}\rfloor +1,\\
q &amp;=  \lfloor\frac{e\cdot d_q - 1}{l}\rfloor +1.
\end{aligned}
\]</span> <span class="math inline">\(p,q\)</span> are prime.</p>
<p>Part 4 Generate and return:</p>
<p>pk: <span class="math inline">\((pq, e)\)</span></p>
<p>sk: <span class="math inline">\((d_p, d_q, p, q)\)</span></p>
<p>hint: <code>(magic, d_p &amp; mask, d_q &amp; mask)</code></p>
<p>where: <span class="math display">\[
\begin{aligned}
\text{magic}&amp;=1337\cdot k^{4} + 7331 \cdot l^3 + 73331 \cdot k^2 +
13337 \cdot l ^2 + 7 \cdot k \cdot l + 2 \cdot k + l,\\
\text{mask}&amp;= 2^{m_s} - 1.
\end{aligned}
\]</span> This indicates that <code>d_p &amp; mask</code> and
<code>d_q &amp; mask</code> are last <span class="math inline">\(m_s=10\)</span> bits of <span class="math inline">\(d_p,d_q\)</span>.</p>
<p>We also want to look at how the program encrypts data:</p>
<p>input: <span class="math inline">\((m,pk=(pq, e))\)</span> output:
<span class="math display">\[
c = m ^ e \bmod n
\]</span></p>
<p>Now, let's look at the main function again.</p>
<p><code>flag</code> is imported from <code>secret</code>, and is
concatenated by a random string with length related to flag itself.
Finally, we encrypt the hexed <code>flag</code> with public key.</p>
<p>Our solution will be divided into 3 parts: 1) Finding <span class="math inline">\(k,l\)</span>; 2) Using <span class="math inline">\(k,l\)</span> and conditions on <span class="math inline">\(d_p,d_q\)</span> to find <span class="math inline">\(d_p, d_q\)</span>; 3) Using <span class="math inline">\(d_p,d_q\)</span> to find <span class="math inline">\(p,q\)</span>; 4) decrypt</p>
<p>Step 1: Finding <span class="math inline">\(k,l\)</span></p>
<p>Expected solution is posted on <a target="_blank" rel="noopener" href="https://github.com/M0urn3r/My-Public-CTF-Challenges#ezRSA+">here</a>.
My attempt also starts from taking the 4th root of <code>magic</code>
then iterates a small range of integers, but I know this quite depends
on luck. The idea is: <span class="math display">\[
k'=(k^4+\frac{res}{1337})^{1/4}&gt;k\text{, but also } k'\approx
k,
\]</span> Thus, we let <span class="math display">\[
\hat{k}=k'-i,i\in\text{ a small range of integers}.
\]</span> But the problem is: how small should this integer set be? For
an accurate solution, we need further investigation on the value of
<span class="math inline">\(k'-k\)</span>, which probably involves
property of inequality of <span class="math inline">\((a^n+b^n)^{1/n}
\leq a+b\)</span>.</p>
<p>Proof of this inequality is simple, involving binomial expansion:
<span class="math display">\[
\begin{aligned}
(a^{1/n}+b^{1/n})^{n} &amp;= a +
\sum_{i=1}^{n-1}C_n^{i}(a^{1/n})^i(b^{1/n})^{n-i}+b\\
&amp;\geq a+b=((a+b)^{1/n})^n
\end{aligned}
\]</span> <span class="math display">\[
\begin{aligned}
&amp;\Longrightarrow (a+b)^{1/n}\leq a^{1/n}+b^{1/n}\\
&amp;\Longrightarrow (a^n+b^n)^{1/n}\leq a+b.
\end{aligned}
\]</span> Thus, let <span class="math inline">\(r =
(\frac{res}{1337})^{1/4}\)</span>, we have: <span class="math display">\[
k'=(k^4+r^4)^{1/4} \leq k+r
\]</span> The upper bound of <span class="math inline">\(k'-k\)</span> is <span class="math inline">\(r\)</span>.</p>
<p>Since <span class="math inline">\(l\)</span> is 60 bits, the range is
actually very large. So I'm not sure why the official solution succeed
from a theoretical perspective. But I can neither find another way to
solve this challenge. I just adapt the way it uses. So the way is to
have: <span class="math display">\[\hat{k}=k'-i\text{ and }\hat{l} =
(\frac{\text{magic}-1337\hat{k}^4}{7331})^{1/3},\]</span> and iterate
them in two loop until find a pair of <span class="math inline">\((\hat{k},\hat{l})\)</span> such that: <span class="math display">\[
1337\cdot \hat{k}^{4} + 7331 \cdot \hat{l}^3 + 73331 \cdot \hat{k}^2 +
13337 \cdot \hat{l} ^2 + 7 \cdot \hat{k} \cdot \hat{l} + 2 \cdot \hat{k}
+ \hat{l}.
\]</span> And this is what we want for <span class="math inline">\((k,l)\)</span>.</p>
<p>Note:</p>
<p>When we write code to calculate <span class="math inline">\(k'\)</span>, <code>pow(a, e, m)</code> will
not work for such large calculation. Thus, we have to use
<code>gmpy2</code> and <code>iroot</code> function.</p>
<p>Step 2: Finding <span class="math inline">\(d_p,d_q\)</span></p>
<p>We go back to <code>line 19</code> and see the equation of <span class="math inline">\(e\)</span>. When we <span class="math inline">\(\bmod k\)</span> and <span class="math inline">\(\bmod l\)</span> obtained in step 1, we can obtain
<span class="math inline">\(d_p^{-1},d_q^{-1}\)</span>, then we can use
inverse function to obtain <span class="math inline">\(d_p,d_q\)</span>.</p>
<p>Step 3: Finding <span class="math inline">\(p,q\)</span></p>
<p>Look at <a href="#pq">equation</a> of <span class="math inline">\(p,q\)</span>. Once we have <span class="math inline">\(d_p,d_q\)</span>, we can simply plug in all the
values and obtain <span class="math inline">\(p,q\)</span>, or we can
use <span class="math inline">\(n=pq\)</span> to calculate the other
factor for convenience.</p>
<p>Now we demonstrate the solution code.</p>
<h4 id="code">Code</h4>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> gcd</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line">N, e = (<span class="number">13144833961692953638155744717380612667335058302310815242506755676885208234342620331186804951145894484501542968789132832800279633590988848298405521677820600481054741175400784558190943019903268095468121342412114428860754522164657102624139527993254089574309927288457799155130004731846999722554981630609692264462023821778810225493633789543259034893395115658330417361250466876018981150507377427664192443342394808337473089411393262018525828475108149889915075872592673448211565529063972264324533136645650169687118301014325354524932405270872098633633071371124551496573869700120350489760340226474892703585296623</span>, <span class="number">4976865541630914024304930292600669330017247151290783019063407119314069119952298933566289617702551408322779629557316539138884407655160925920670189379289389411163083468782698396121446186733546486790309424372952321446384824084362527492399667929050403530173432700957192011119967010196844119305465574740437</span>)</span><br><span class="line">g, dp_mask, dq_mask = (<span class="number">154118536863381755324327990994045278493514334577571515646858907141541837890</span>, <span class="number">431</span>, <span class="number">217</span>)</span><br><span class="line">c = <span class="number">12075538182684677737023332074837542797880423774993595442794806087281173669267997104408555839686283996516133283992342507757326913240132429242004071236464149863112788729225204797295863969020348408992315952963166814392745345811848977394200562308125908479180595553832800151118160338048296786712765863667672764499042391263351628529676289293121487926074423104988380291130127694041802572569416584214743544288441507782008422389394379332477148914009173609753877263990429988651290402630935296993764147874437465394433756515223371180032964253037946818633821940103044535390973722964105390263537722948112571112911062</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">magic</span>(<span class="params">k, l</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1337</span> * k ** <span class="number">4</span> + <span class="number">7331</span> * l ** <span class="number">3</span> + <span class="number">73331</span> * k ** <span class="number">2</span> + <span class="number">13337</span> * l ** <span class="number">2</span> + <span class="number">7</span> * k * l + <span class="number">2</span> * k + l</span><br><span class="line"></span><br><span class="line">k_approx = gmpy2.iroot(g//<span class="number">1337</span>, <span class="number">4</span>)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">50</span>):</span><br><span class="line">    k_bar = k_approx - i</span><br><span class="line">    t1_approx = <span class="number">1337</span> * k_bar ** <span class="number">4</span></span><br><span class="line">    l_approx = gmpy2.iroot((g-t1_approx)//<span class="number">7331</span>, <span class="number">3</span>)[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">50</span>):</span><br><span class="line">        l_bar = l_approx-j</span><br><span class="line">        <span class="keyword">if</span> magic(k_bar, l_bar) == g:</span><br><span class="line">            <span class="keyword">if</span> gcd(k_bar, l_bar) == <span class="number">1</span>:</span><br><span class="line">                k = k_bar</span><br><span class="line">                l = l_bar</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">mask = <span class="number">2</span> ** <span class="number">10</span> - <span class="number">1</span></span><br><span class="line">d_q = inverse(e%l, l)</span><br><span class="line"><span class="keyword">assert</span> d_q &amp; mask == dq_mask</span><br><span class="line">q = (e * d_q - <span class="number">1</span>)//l + <span class="number">1</span></span><br><span class="line">p = N//q</span><br><span class="line"></span><br><span class="line">d = inverse(e, (p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line">m = <span class="built_in">pow</span>(c, d, N)</span><br><span class="line">print(m)</span><br><span class="line">print(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(m)[<span class="number">2</span>:]))</span><br></pre></td></tr></tbody></table></figure>
<p>result: </p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">b<span class="string">'\xcd]\xf8\xe7\x97\xe2\xfds\x1c\x84\xd3/\x8e\xba}\xaeU[_\x12a\x9f\x07+\xe7\x15L\x97\x8e\x99\x1f\n\xa1Lq\xf3\x06^\xa9\xc7\xf0\xeb\x93BNfHk\xc61t\xc0\x02\xcf\xaf[Z\x9dMOo"\xf2\xa5\xa9o\xb6l9\xab\xc3\xe7\x15O\r,</span></span><br><span class="line"><span class="string">&lt;~\xb51\xea\xfaD\xa7n\x80\xb7\x97\x83[\xfag\xe1\xc3\xa3+\x9b\x91\xf9\x16\xd6\xef}\xf9\xf7\xb5i\x06\xdd\x19\xef5\xc9\xd28(\x7f\'</span>dp]\xd8\x85\x07\x911\xd0\xa7\x12\xb3X\xe0\xa7\x193j </span><br><span class="line">7\x931\xe3\xc2\x0e\xf7B\xf2\xf6\x1a\x05&amp;\r\x01\xa2\xe2dd\xb6\xbe\x9b\x81V\xaa\xf4\x99\xc7Wa\xbcf\xb9\xd4\xee\xee\<span class="string">'\xdb\x02\xdb\x83Y\xb9\xc1w\xf5\xb7\x8a\xb6\x19\xb3\x13\x0f\xe2H\xce\xe9\xcc\xb7\xf2\xc6\x8at</span></span><br><span class="line"><span class="string">flag{laTTice_a77ack_on_RSA_h0VV_far_can_w3_Go???}'</span></span><br></pre></td></tr></tbody></table></figure><p></p>
<h3 id="reference">Reference</h3>
<p>This paper may also help, but I haven't read it: <a target="_blank" rel="noopener" href="https://www.iacr.org/archive/crypto2007/46220372/46220372.pdf">Finding
Small Roots of Bivariate Integer<br>
Polynomial Equations: a Direct Approa</a></p>
<h2 id="ezrsa-1">ezRSA+</h2>
<h3 id="challenge-1">Challenge</h3>
<p>The code is pretty much similar to the previous one, but 2 things
changed:</p>
<ol type="1">
<li>no <code>magic</code> any more;</li>
<li><code>m_size = 12</code></li>
</ol>
<p>Output from the challenge becomes:</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">N, e = (<span class="number">5943169364392579648240628105465400265561630477719849140342288893646282358845864829196464904298425034495515703590715696166689341849788423790118035115884268058450057766891418761627136386260375534474238287294722575087291704432681906513559934960801746158191355141430407698622886747610818853554584519369492697299961587570531415598410602926850787615266600194130088653542080297272898142822126215764285317511778718862825024939241749996811603610592132845393755564618871967716819173935553139267269362451423802419847919801412517294612793840767037662589233422389282092051866024514599213445596030685325227269609799</span>, <span class="number">1762727270442607836236621349004505613506359415168929966540357011133047321101203605340201016757203407375680206339341465088639129039278027484128644822299382121442456525803635369125157261704416172232695058332167310707999473221769390010733123910955508477009411113166141188309425895082608534271594076218827</span>)</span><br><span class="line">dp_m, dq_m = (<span class="number">1361</span>, <span class="number">1475</span>)</span><br><span class="line">c = <span class="number">4531542437692818645025309324015912433184165181252393791711464775823247402127139569010657935303362440253951226047224610112010632226435610975118324658493911658016955717228741291266124372004503735693124810068041692730706167827666860062121413284053921548345924563903211959003376490264228814415500106847482893238907846512437694006785527867729127228361388592714377847012086312471372061723017560705890925568994607972832373362380226566506368932968108567819188587148829190811891555283157485379418388715910299951228404648535235675640369275644493614250037857212768450860647393276921502407057557208885073276533644</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="solution-1">Solution</h3>
<p>Although it just removed one line and changed m size, the influence
is huge. We cannot obtain <span class="math inline">\(k,l\)</span> from
the <code>magic</code> any more. So our method to solve this problem
should be completely changed. This is where lattice attack involves.</p>
<p>I have studied two methods to solve this, but I'll save the official
one for ezRSA++ later. The method I used to solve this one is using LLL
to get the values of <span class="math inline">\(k,l\)</span>, and the
rest steps are pretty the same. This method is proposed by
Bleichenbacher and May [^1][^2].</p>
<p>We still look back at <a href="#pq">equation</a> for <span class="math inline">\(p,q\)</span>, which can be rewritten as: <span class="math display">\[
\left\{
\begin{aligned}
(p-1)k=ed_p-1\\
(q-1)l=ed_q-1\\
\end{aligned}
\right.
\]</span> <span class="math display">\[
\Longrightarrow
\left\{
\begin{aligned}
kp&amp;=ed_p+(k-1)\\
lq&amp;=ed_q+(l-1)\\
\end{aligned}
\right.
\]</span> Multiply these two equations to obtain: <span class="math display">\[
e^2X+eY+(1-N)Z = W,
\]</span> where: <span class="math display">\[
\begin{aligned}
X &amp;= d_pd_q\\
Y &amp;= d_p(l-1)+d_q(k-1)\\
Z &amp;= kl\\
W &amp;= k+l-1
\end{aligned}
\]</span> We write the above in the matrix form: <span class="math display">\[
\begin{bmatrix}
    X &amp; Y &amp; Z
\end{bmatrix}
\cdot
\begin{bmatrix}
    e^2 &amp; 1 &amp; 0 &amp; 0 \\
    e &amp; 0 &amp; 1 &amp; 0 \\
    1-N &amp; 0 &amp; 0 &amp; 1
\end{bmatrix}
=
\begin{bmatrix}
    W &amp; X &amp; Y &amp; Z
\end{bmatrix}
\]</span> Since <span class="math inline">\(d_p, d_q, k, l\)</span> are
not very large (only 60 bits), we can actually construct a lattice to
solve this linear relationship and obtain the values of <span class="math inline">\(X,Y,Z,W\)</span>. Then, we put all the constraints
into z3 solver and obtain <span class="math inline">\(d_p,d_q,k,l\)</span>.</p>
<p>The rest will be the same as ezRSA.</p>
<p>Note:</p>
<p>Here's one thing that's interesting. When I use <code>LLL()</code>
from sage, it actually calculated and output <span class="math inline">\(\begin{bmatrix}-W &amp; -X &amp; -Y &amp;
-Z\end{bmatrix}\)</span>. So I have to add another step to make them
positive.</p>
<h4 id="code-1">Code</h4>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">N, e = (<span class="number">5943169364392579648240628105465400265561630477719849140342288893646282358845864829196464904298425034495515703590715696166689341849788423790118035115884268058450057766891418761627136386260375534474238287294722575087291704432681906513559934960801746158191355141430407698622886747610818853554584519369492697299961587570531415598410602926850787615266600194130088653542080297272898142822126215764285317511778718862825024939241749996811603610592132845393755564618871967716819173935553139267269362451423802419847919801412517294612793840767037662589233422389282092051866024514599213445596030685325227269609799</span>, <span class="number">1762727270442607836236621349004505613506359415168929966540357011133047321101203605340201016757203407375680206339341465088639129039278027484128644822299382121442456525803635369125157261704416172232695058332167310707999473221769390010733123910955508477009411113166141188309425895082608534271594076218827</span>)</span><br><span class="line">dp_m, dq_m = (<span class="number">1361</span>, <span class="number">1475</span>)</span><br><span class="line">c = <span class="number">4531542437692818645025309324015912433184165181252393791711464775823247402127139569010657935303362440253951226047224610112010632226435610975118324658493911658016955717228741291266124372004503735693124810068041692730706167827666860062121413284053921548345924563903211959003376490264228814415500106847482893238907846512437694006785527867729127228361388592714377847012086312471372061723017560705890925568994607972832373362380226566506368932968108567819188587148829190811891555283157485379418388715910299951228404648535235675640369275644493614250037857212768450860647393276921502407057557208885073276533644</span></span><br><span class="line"></span><br><span class="line">M = Matrix(ZZ, [[   e*e, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">                [     e, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>],</span><br><span class="line">                [   <span class="number">1</span>-N, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>]])</span><br><span class="line"></span><br><span class="line">v = M.LLL()[<span class="number">0</span>]</span><br><span class="line">v0, v1, v2, v3 = [<span class="built_in">int</span>(-v[i]) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>)]</span><br><span class="line"></span><br><span class="line">sol = Solver()</span><br><span class="line">dp, dq, k, l = Ints(<span class="string">'dp dq k l'</span>)</span><br><span class="line"><span class="comment"># k, l = Ints('k l')</span></span><br><span class="line">sol.add(k + l - <span class="number">1</span> == v0)</span><br><span class="line">sol.add(dp * dq == v1)</span><br><span class="line">sol.add(dp * (l - <span class="number">1</span>) + dq * (k - <span class="number">1</span>) == v2)</span><br><span class="line">sol.add(k * l == v3)</span><br><span class="line"></span><br><span class="line">sol.check()</span><br><span class="line"></span><br><span class="line">dp, dq, k, l = sol.model()[dp].as_long(), sol.model()[dq].as_long(), sol.model()[k].as_long(), sol.model()[l].as_long()</span><br><span class="line"></span><br><span class="line">p = (e * dp - <span class="number">1</span>) // k + <span class="number">1</span></span><br><span class="line">q = N // p</span><br><span class="line"></span><br><span class="line">d = inverse(e, (p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line">m = <span class="built_in">pow</span>(c, d, N)</span><br><span class="line">print(m)</span><br><span class="line">print(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(m)[<span class="number">2</span>:]))</span><br></pre></td></tr></tbody></table></figure>
<p>result:</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">b<span class="string">'O@]T&lt;\xbazZ\xed\xfe\xfeQm&gt;g\x0b\x9d9\xac\x14\xc2\x04\xf4/\xa5\xcb\x91\xc2\x82u]\xd3\x03\xec\xcc\xa64_\xbfko,\xe1a\x99G\xe0\xb8\xd6\xe2\x02\xe1T\xaan\x0b\xeeu\x9e\x12\xf2\x9bLS6\xf7\x91\xa0 v\x863\x80\xda.\xb0N\x8b\xcdl\x96\xc4\x00\xbb^uL\xa2\x13&gt;%8+y\xd8{F\xdd\xc9\x0ct\xce\xd6\x01\xa1\xe8\x86!.d\x9d\x88\xd4"\x90\xd7\r\x1e{t\x14wp\xa4\x99\x83\xa1\x19\xaf\x1a\x00\xe8_\xd1\x8b\xa9S\xb8\x17\r\xf1{\x9a\xd8\xb7\x1eI\tT-[s\x8a)}\xb1i\xf2.7\x9e\xa2\xd9dyQL\x05}\xc8S]C\xef\x0c63u)v\x86\x19\xba\x93\xf2[\xb3\xa6\xe7E)\x9f\x1e\x9075]\x81\xfd,\xbc\xf1Xw\xfb\xf1\xf6\x86\xf9d\xf6m\xdcp\xafflag{s0rry_4_the_si11y_mis7ak3!!!}'</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="reference-1">Reference</h3>
<p>[^1] New Attacks on RSA with Small Secret CRT-Exponents: <a target="_blank" rel="noopener" href="https://www.cits.ruhr-uni-bochum.de/imperia/md/content/may/paper/crt.pdf">paper</a>
[^2] A Polynomial Time Attack on RSA with Private CRT-Exponents Smaller
Than <span class="math inline">\(N^{0.073}\)</span>: <a target="_blank" rel="noopener" href="https://www.iacr.org/archive/crypto2007/46220388/46220388.pdf">paper</a></p>
<h2 id="ezrsa-2">ezRSA++</h2>
<p>Based on 0CTF 2021 Finals "<a target="_blank" rel="noopener" href="https://github.com/M0urn3r/My-Public-CTF-Challenges#ezRSA+">ezRSA+</a>",
the intended solution is <em>"Partial Key Exposure Attack on Short
Secret Exponent CRT-RSA"</em>. Maybe the method in <em>"Small
CRT-exponent RSA revisited"</em> also works</p>
<h3 id="challenge-2">Challenge</h3>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> os <span class="keyword">import</span> urandom</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ExGCD</span>(<span class="params">a, b</span>):</span></span><br><span class="line">    <span class="keyword">if</span> <span class="number">0</span> == b:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>, <span class="number">0</span>, a</span><br><span class="line">    x, y, q = ExGCD(b, a % b)</span><br><span class="line">    x, y = y, (x - a // b * y)</span><br><span class="line">    <span class="keyword">return</span> x, y, q</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gen</span>(<span class="params">p_size, d_size, l_size</span>):</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        p = getPrime(p_size)</span><br><span class="line">        q = getPrime(p_size)</span><br><span class="line">        <span class="keyword">if</span> GCD(p - <span class="number">1</span>, q - <span class="number">1</span>) == <span class="number">2</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    d_p = getPrime(d_size)</span><br><span class="line">    d_q = getPrime(d_size)</span><br><span class="line">    s, t, g = ExGCD(p - <span class="number">1</span>, q - <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">if</span> s &lt; <span class="number">0</span>:</span><br><span class="line">        s += q - <span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        t += p - <span class="number">1</span></span><br><span class="line">    n = p * q</span><br><span class="line">    phi = (p - <span class="number">1</span>) * (q - <span class="number">1</span>)</span><br><span class="line">    e = (inverse(d_p, p - <span class="number">1</span>) * t * (q - <span class="number">1</span>) + inverse(d_q, q - <span class="number">1</span>)  * s * (p - <span class="number">1</span>)) // g % phi</span><br><span class="line">    <span class="keyword">assert</span> (e * d_q % (q - <span class="number">1</span>) == <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">assert</span> (e * d_p % (p - <span class="number">1</span>) == <span class="number">1</span>)</span><br><span class="line">    k = (e * d_p - <span class="number">1</span>) // (p - <span class="number">1</span>)</span><br><span class="line">    l = (e * d_q - <span class="number">1</span>) // (q - <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> (n, e), (d_p, d_q, p, q), (d_p % (<span class="number">2</span>**l_size), d_q % (<span class="number">2</span>**l_size))</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span>(<span class="params">m, pk</span>):</span></span><br><span class="line">    n, e = pk</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">pow</span>(m, e, n)</span><br><span class="line"></span><br><span class="line">p_size = <span class="number">1000</span></span><br><span class="line">d_size = <span class="number">105</span></span><br><span class="line">l_size = <span class="number">55</span></span><br><span class="line">pk, sk, hint = gen(p_size, d_size, l_size)</span><br><span class="line">flag = urandom(<span class="number">2</span> * p_size // <span class="number">8</span> - <span class="built_in">len</span>(flag) - <span class="number">1</span>) + flag</span><br><span class="line">enc = encrypt(<span class="built_in">int</span>(flag.<span class="built_in">hex</span>(), <span class="number">16</span>), pk)</span><br><span class="line">print(enc)</span><br><span class="line">print(pk)</span><br><span class="line">print(hint)</span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">35558284230663313298312684064040643811204702946900174110911295087662938676356112802781671547473910691476600838877279843972105403072929243674403244286458898562457747942651643439624568905004454158744508429126554955023110569348839934098381885098523538078300248638407684468503519326866276798222721018258242443186786917829878515320321445508466038372324063139762003962072922393974710763356236627711414307859950011736526834586028087922704589199885845050751932885698053938070734392371814246294798366452078193195538346218718588887085179856336533576097324041969786125752304133487678308830354729347735644474025828</span></span><br><span class="line"><span class="string">(44774502335951608354043148360684114092901940301155357314508676399067538307546121753785009844275454594381602690061553832466871574728524408152400619047820736137949166290404514747591817206669966103047443912935755873432503095952914080827536130899968275165557303493867755627520568588808534411526058896791373252974606364861105086430729757064078675811147972536205086402752245214343186536177015741922559575575911278873118556603923689408629477875537332177644886701517140711134017511229202430437068095342526435886609381176269251580339549071944830141516001532825295594908434587285225415103472279090325281062442217, 29624366183227462965645558392954094074485353876807451497147549927093025197118051280445930543762170853769573962200247669305286333212410439624262142109295839433584663989554419810341266820063074908743295553517790354149623873028162282751352613333181218478850463012413786673509078012976454604598813805735677104174112776060905225493357010861225261560490401501912259585922988353328944884443953564154752191932500561561256069872534626325000901099904014035414792860997025614313564862063784602254606240743545483125618939111639728114664995759380293512809125885893543730614962375399353971677980309835647540883700977)</span></span><br><span class="line"><span class="string">(5013415024346389, 4333469053087705)</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="solution-2">Solution</h3>
<p>Although I solved the previous two challenges, I didn't solve this
one. I was thinking about Bleichenbacher-May attack and hope that with
several modifications I can solve it, but the fact is</p>
<p>(to be finished)</p>
<h4 id="code-2">Code</h4>
<h3 id="reference-2">Reference</h3>
<p>Partial Key Exposure Attack on Short Secret Exponent CRT-RSA: <a target="_blank" rel="noopener" href="https://eprint.iacr.org/2021/972.pdf">paper</a></p>
<p>Small CRT-exponent RSA revisited: <a target="_blank" rel="noopener" href="https://eprint.iacr.org/2017/092.pdf">paper</a></p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/CTF/" rel="tag"># CTF</a>
              <a href="/tags/Cryptography/" rel="tag"># Cryptography</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2023/02/04/Paper-I-Read/MRM/understanding-MRM-1/" rel="prev" title="Measure-Rewind-Measure Paper Reading 1 - FO transform under ROM">
                  <i class="fa fa-chevron-left"></i> Measure-Rewind-Measure Paper Reading 1 - FO transform under ROM
                </a>
            </div>
            <div class="post-nav-item">
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments" id="gitalk-container"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Daisy</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a>
  </div>


  <script src='https://unpkg.com/mermaid@/dist/mermaid.min.js'></script>
  <script>
    if (window.mermaid) {
      mermaid.initialize({theme: 'forest'});
    }
  </script>

    </div>
  </footer>

  
  <script src="//cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/@next-theme/pjax@0.4.0/pjax.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script><script>
var pjax = new Pjax({
  selectors: [
    'head title',
    '.page-configurations',
    '.main-inner',
    '.post-toc-wrap',
    '.languages',
    '.pjax'
  ],
  analytics: false,
  cacheBust: false,
  scrollRestoration: false,
  scrollTo: !CONFIG.bookmark.enable
});

document.addEventListener('pjax:success', () => {
  pjax.executeScripts(document.querySelectorAll('script[data-pjax], .pjax script'));
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.subMenu)
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  const hasTOC = document.querySelector('.post-toc');
  document.querySelector('.sidebar-inner').classList.toggle('sidebar-nav-active', hasTOC);
  document.querySelector(hasTOC ? '.sidebar-nav-toc' : '.sidebar-nav-overview').click();
  NexT.utils.updateSidebarPosition();
});
</script>


  





<script data-pjax>
if (document.querySelectorAll('.mermaid').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mermaid@8.8.3/dist/mermaid.min.js', () => {
    mermaid.init({
      theme    : 'dark',
      logLevel : 3,
      flowchart: { curve     : 'linear' },
      gantt    : { axisFormat: '%m/%d/%Y' },
      sequence : { actorMargin: 50 }
    }, '.mermaid');
  }, window.mermaid);
}
</script>


  




    <div class="pjax">

  <script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'none'
      },
      options: {
        renderActions: {
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              const target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    const script = document.createElement('script');
    script.src = '//cdn.jsdelivr.net/npm/mathjax@3.1.2/es5/tex-mml-chtml.js';
    script.defer = true;
    document.head.appendChild(script);
  } else {
    MathJax.startup.document.state(0);
    MathJax.typesetClear();
    MathJax.texReset();
    MathJax.typeset();
  }
</script>



<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1.7.0/dist/gitalk.css">

<script>
NexT.utils.loadComments('#gitalk-container', () => {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/gitalk@1.7.0/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID    : 'bf0bd12b8583ef8ad436',
      clientSecret: 'f092c892e481e1251ac2eb285b2e4130b2de811b',
      repo        : 'RdWeirdo981.github.io',
      owner       : 'RdWeirdo981',
      admin       : ['RdWeirdo981'],
      id          : 'b559617e616b60df3548d89702d7bb81',
        language: 'en',
      distractionFreeMode: true
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
});
</script>

    </div>
</body>
</html>
