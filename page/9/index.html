<!DOCTYPE html>
<html lang="en">
<head>
	<!--pjax: don't stop the music-->
  <script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.js"></script>
  
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Merriweather:300,300italic,400,400italic,700,700italic|Syne+Mono:300,300italic,400,400italic,700,700italic|Abril+Fatface:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.1/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"rdweirdo981.github.io","root":"/","images":"/images","scheme":"Pisces","version":"8.1.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"gitalk","storage":true,"lazyload":false,"nav":null,"activeClass":"gitalk"},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}};
  </script>
<meta name="description" content="Cryptography | Mathematics | InfoSec | etc.">
<meta property="og:type" content="website">
<meta property="og:title" content="Life φlosophy">
<meta property="og:url" content="https://rdweirdo981.github.io/page/9/index.html">
<meta property="og:site_name" content="Life φlosophy">
<meta property="og:description" content="Cryptography | Mathematics | InfoSec | etc.">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Daisy">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://rdweirdo981.github.io/page/9/">


<script data-pjax class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>
<title>Life φlosophy</title>
  



  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>


<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Life φlosophy</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li>
        <li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
        <li class="menu-item menu-item-collection"><a href="/collection/" rel="section"><i class="fa fa-globe fa-fw"></i>Resources</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
		<iframe src="https://open.spotify.com/embed/track/5Q777K2mEK7lxZHROGIZrt?utm_source=generator" width="100%" height="80" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"></iframe>
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <section class="post-toc-wrap sidebar-panel">
        </section>
        <!--/noindex-->

        <section class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Daisy"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">Daisy</p>
  <div class="site-description" itemprop="description">Cryptography | Mathematics | InfoSec | etc.</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">28</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">15</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">37</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



        </section>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://rdweirdo981.github.io/2022/10/12/CTF/TCTF-0CTF-2022/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Daisy">
      <meta itemprop="description" content="Cryptography | Mathematics | InfoSec | etc.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Life φlosophy">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/10/12/CTF/TCTF-0CTF-2022/" class="post-title-link" itemprop="url">TCTF/0CTF 2022 Crypto</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-10-12 00:53:02" itemprop="dateCreated datePublished" datetime="2022-10-12T00:53:02+08:00">2022-10-12</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2023-01-06 00:43:52" itemprop="dateModified" datetime="2023-01-06T00:43:52+08:00">2023-01-06</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/3-Catch-The-Flag/" itemprop="url" rel="index"><span itemprop="name">3. Catch The Flag</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/3-Catch-The-Flag/CTF-Crypto/" itemprop="url" rel="index"><span itemprop="name">CTF-Crypto</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="real_magic_dlog">real_magic_dlog</h2>
<h3 id="problem-description">Problem description</h3>
<p>Based on HITCON 2021 "magic dlog". According to its author <span class="citation" data-cites="lyc">@lyc</span>, the intended solution is
<em>"Finding Smooth Integers in Short Intervals Using CRT
Decoding"</em>.</p>
<h4 id="proof-of-work">proof of work</h4>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">proof_of_work</span>(<span class="params">self</span>):</span></span><br><span class="line">    random.seed(urandom(<span class="number">8</span>))</span><br><span class="line">    proof = <span class="string">''</span>.join([random.choice(string.ascii_letters + string.digits + <span class="string">'!#$%&amp;*-?'</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>)])</span><br><span class="line">    digest = sha256(proof.encode()).hexdigest()</span><br><span class="line">    self.dosend(<span class="string">'sha256(XXXX + {}) == {}'</span>.<span class="built_in">format</span>(proof[<span class="number">4</span>: ], digest))</span><br><span class="line">    self.dosend(<span class="string">'Give me XXXX:'</span>)</span><br><span class="line">    x = self.request.recv(<span class="number">10</span>)</span><br><span class="line">    x = (x.strip()).decode(<span class="string">'utf-8'</span>) </span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(x) != <span class="number">4</span> <span class="keyword">or</span> sha256((x + proof[<span class="number">4</span>: ]).encode()).hexdigest() != digest: </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br></pre></td></tr></tbody></table></figure>
<h4 id="dlog">dlog</h4>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">handle</span>(<span class="params">self</span>):</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        signal.signal(signal.SIGALRM, self.timeout_handler)</span><br><span class="line">        signal.alarm(<span class="number">50</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.proof_of_work():</span><br><span class="line">            self.dosend(<span class="string">'You must pass the PoW!'</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        signal.alarm(<span class="number">60</span>)</span><br><span class="line">        magic = urandom(LEN)</span><br><span class="line">        magic_num = bytes_to_long(magic)</span><br><span class="line">        self.dosend(magic.<span class="built_in">hex</span>())</span><br><span class="line">        self.dosend(<span class="string">'P:&gt;'</span>)</span><br><span class="line">        P = <span class="built_in">int</span>(self.request.recv(<span class="number">100</span>).strip(), <span class="number">16</span>)</span><br><span class="line">        self.dosend(<span class="string">'E:&gt;'</span>)</span><br><span class="line">        E = <span class="built_in">int</span>(self.request.recv(<span class="number">100</span>).strip(), <span class="number">16</span>)</span><br><span class="line">        self.dosend(<span class="string">'data:&gt;'</span>)</span><br><span class="line">        data = self.request.recv(<span class="number">100</span>).strip()</span><br><span class="line">        num1 = <span class="built_in">int</span>(data, <span class="number">16</span>)</span><br><span class="line">        <span class="keyword">if</span> P &gt;&gt; (<span class="number">384</span> - LEN * <span class="number">8</span>) == magic_num <span class="keyword">and</span> isPrime(P):</span><br><span class="line">            data2 = sha384(data).hexdigest()</span><br><span class="line">            num2 = <span class="built_in">int</span>(data2, <span class="number">16</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">pow</span>(num1, E, P) == num2 % P:</span><br><span class="line">                self.dosend(flag)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                self.dosend(<span class="string">'try harder!!!'</span>)</span><br><span class="line">    <span class="keyword">except</span> TimeoutError:</span><br><span class="line">        self.dosend(<span class="string">'Timeout!'</span>)</span><br><span class="line">        self.request.close()</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        self.dosend(<span class="string">'Wtf?'</span>)</span><br><span class="line">        self.request.close()</span><br></pre></td></tr></tbody></table></figure>
<h3 id="solution">Solution</h3>
<h4 id="proof-of-work-1">proof of work</h4>
<p>The proof of work part requires us to break the first 4 chars of a
random 8 bytes string. We are given the condition where the SHA-256 of
the string is shown.</p>
<p>For example, we are shown something like:</p>
<blockquote>
<p>sha256(XXXX + n56#&amp;U856iv#8vI3) ==
fb3d8b097f094662b84c90fd6faca83a385a075dc2e25f477b379da7408dac19 Give me
XXXX:</p>
</blockquote>
<p>We can just iterate all the possible combinations since the
complexity isn't too large. It's just a PoW anyway.</p>
<p>The interactive code is below.</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">from</span> string <span class="keyword">import</span> digits, ascii_letters</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"></span><br><span class="line"><span class="comment"># connection</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dosend</span>(<span class="params">sock, msg</span>):</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        sock.sendall(msg.encode(<span class="string">'latin-1'</span>))</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">HOST = <span class="string">"202.120.7.219"</span></span><br><span class="line">PORT = <span class="number">15555</span></span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">c = s.connect((HOST, PORT))</span><br><span class="line">s.sendall(<span class="string">b""</span>)</span><br><span class="line">resp = s.recv(<span class="number">1024</span>).decode().strip()</span><br><span class="line">digest_compare = resp[<span class="number">35</span>:]</span><br><span class="line">proof_rest = resp[<span class="number">14</span>:<span class="number">30</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># breaking SHA-256 first 4 places</span></span><br><span class="line">alpha_bet = digits+ascii_letters+<span class="string">"!#$%&amp;*-?"</span></span><br><span class="line">strlist = itertools.product(alpha_bet, repeat=<span class="number">4</span>)</span><br><span class="line">xxxx = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> strlist:</span><br><span class="line">    data = i[<span class="number">0</span>] + i[<span class="number">1</span>] + i[<span class="number">2</span>] + i[<span class="number">3</span>]</span><br><span class="line">    data_sha = sha256((data + proof_rest).encode(<span class="string">'utf-8'</span>)).hexdigest()</span><br><span class="line">    <span class="keyword">if</span> (data_sha == digest_compare):</span><br><span class="line">        xxxx = data</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># send pow</span></span><br><span class="line">resp = s.recv(<span class="number">1024</span>).decode().strip()</span><br><span class="line">s.sendall(xxxx.encode())</span><br></pre></td></tr></tbody></table></figure>
<h4 id="dlog-1">dlog</h4>
<p>The expected solution should be from this paper: <a target="_blank" rel="noopener" href="https://dl.acm.org/doi/10.1145/335305.335337">Finding Smooth
Integers in Short Intervals Using CRT Decoding</a> Although, in the
description, the challenge mentions that this problem is developed from
HITCON 2021 "magic dlog". I searched on the internet and found a <a target="_blank" rel="noopener" href="https://tl2cents.github.io/2021/12/14/Hitcon2021-Crypto-Writeup/">solution</a>
for HITCON 2021 version. By slightly adjusting the code, the solution
can be applied to this challenge.</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span>  is_prime</span><br><span class="line"><span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">LEN = <span class="number">17</span></span><br><span class="line">magic_num = <span class="built_in">int</span>(resp, <span class="number">16</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">65536</span>):</span><br><span class="line">    n = magic_num * <span class="number">2</span> ** (<span class="number">384</span> - LEN*<span class="number">8</span>) + i * <span class="number">2</span> ** (<span class="number">384</span> - LEN*<span class="number">8</span> - <span class="number">16</span>)</span><br><span class="line">    <span class="keyword">if</span> is_prime(n + <span class="number">1</span>):</span><br><span class="line">        f = factor(n)</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">all</span>(p &lt; <span class="number">2</span> ** <span class="number">40</span> <span class="keyword">for</span> p, e <span class="keyword">in</span> f):</span><br><span class="line">            num1 = primitive_root(n+<span class="number">1</span>)</span><br><span class="line">            data = <span class="built_in">int</span>(num1).to_bytes(<span class="number">2</span>, <span class="string">'big'</span>).<span class="built_in">hex</span>().encode(<span class="string">'latin-1'</span>).strip()</span><br><span class="line">            data2 = sha384(data).hexdigest()</span><br><span class="line">            num2 = <span class="built_in">int</span>(data2, <span class="number">16</span>)</span><br><span class="line">            e = discrete_log(Zmod(n+<span class="number">1</span>)(num2), Zmod(n+<span class="number">1</span>)(num1))</span><br><span class="line">            <span class="keyword">if</span> (n+<span class="number">1</span>) &gt;&gt; (<span class="number">384</span> - LEN * <span class="number">8</span>) == magic_num <span class="keyword">and</span> isPrime(n+<span class="number">1</span>): <span class="comment">#only for check</span></span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">pow</span>(num1, e, n+<span class="number">1</span>) == num2 % (n + <span class="number">1</span>): <span class="comment">#only for check</span></span><br><span class="line">                </span><br><span class="line">                    resp = s.recv(<span class="number">1024</span>).decode().strip()</span><br><span class="line">                    print(resp) <span class="comment"># P: </span></span><br><span class="line">                    s.sendall(<span class="built_in">hex</span>(n+<span class="number">1</span>).encode(<span class="string">'latin-1'</span>)) <span class="comment"># send P</span></span><br><span class="line"></span><br><span class="line">                    resp = s.recv(<span class="number">1024</span>).decode().strip()</span><br><span class="line">                    print(resp) <span class="comment"># e: </span></span><br><span class="line">                    s.sendall(<span class="built_in">hex</span>(e).encode(<span class="string">'latin-1'</span>)) <span class="comment"># send e</span></span><br><span class="line"></span><br><span class="line">                    resp = s.recv(<span class="number">65536</span>).decode().strip()</span><br><span class="line">                    print(resp) <span class="comment"># data: </span></span><br><span class="line">                    s.sendall(data) <span class="comment"># send data</span></span><br><span class="line"></span><br><span class="line">                    resp = s.recv(<span class="number">1024</span>).decode().strip()</span><br><span class="line">                    print(resp) <span class="comment"># msg</span></span><br><span class="line"></span><br><span class="line">                    <span class="keyword">break</span></span><br></pre></td></tr></tbody></table></figure>
<p>We still want to look at how this works.</p>
<p>The challenge first generates a random 17 bytes (136 bits) and
converts it to long integer as a <code>magic_num</code> <span class="math inline">\(m\)</span>. We are given the hex of this number
and expected to find a proper set of <span class="math inline">\(\{P,\;
E,\; {\rm data}\}\)</span> such that: <span class="math display">\[
\begin{aligned}
\lfloor {P \over {2^{248}}} \rfloor = m\; ;\\
P \; {\rm is \; prime.}
\end{aligned}
\]</span> It also means that the first 136 bits of <span class="math inline">\(P\)</span> should be exactly equal to bits in
<span class="math inline">\(m\)</span>. Since <span class="math inline">\(P\)</span> is prime, <span class="math inline">\(P-1\)</span> can be <span class="math inline">\(m
\cdot 2^{248} + i\)</span>, where <span class="math inline">\(i \in
[2^{247}, 2^{248})\)</span> is an even number.</p>
<p>Here, I learned a trick from the <a target="_blank" rel="noopener" href="https://tl2cents.github.io/2021/12/14/Hitcon2021-Crypto-Writeup/">solution</a>.
We can actually only iterate the highest 16 bits after 136 bits and let
all the rest be 0's. It will make the factorization of <span class="math inline">\(P-1\)</span> way easier and faster.</p>
<p>Also, there's another condition on this set. Let <code>data2</code>
be hexdigest of sha384 of the input <code>data</code>. <code>num1</code>
and <code>num2</code> are integer converted from <code>data</code> and
<code>data2</code>. The other constraints on <span class="math inline">\(\{P,\; E,\; {\rm data}\}\)</span> are: <span class="math display">\[
\begin{aligned}
n_{1}^{E} &amp;\equiv n_{2} \mod P \\
n_{1} &amp;= {\rm int(data, 16)}\\
n_{2} &amp;= {\rm int(sha384(data), 16)}
\end{aligned}
\]</span> It can be clearly seen that this is a Discrete Logarithm (DL)
problem. The core method for this kind of problem is to find a enough
smooth <span class="math inline">\(P\)</span> so that <span class="math inline">\(E\)</span> can be easily/quickly obtained by
calling <code>discrete_log</code> from SageMath (I'll write a sum-up
later for these maths/cryptanalysis tools). The smoothness can be
restricted by conditioning all factors of rank of <span class="math inline">\(P\)</span> (which is <span class="math inline">\(P-1\)</span> since <span class="math inline">\(P\)</span> is prime) to be no greater than 40 (or
50 if it doens't work).</p>
<p>The detailed explaination can be found <a target="_blank" rel="noopener" href="https://lazzzaro.github.io/2020/05/07/crypto-%E7%A6%BB%E6%95%A3%E5%AF%B9%E6%95%B0/index.html">here</a>
(in Chinese). This kind of algorithm is called
<strong>Pohlig-hellman</strong>. The conditions of applying
Pohlig-hellman to find DLP solution in limited time is:</p>
<p><span class="math display">\[g^{x} \equiv a \mod P,\; {\rm
g\;is\;the\;primitive\;root\;of\;P.}\]</span> Thus, we can set <span class="math inline">\(n_{1}\)</span> to be the primitive root of <span class="math inline">\(P\)</span>.</p>
<h3 id="reference">Reference</h3>
<p><a target="_blank" rel="noopener" href="https://tl2cents.github.io/2021/12/14/Hitcon2021-Crypto-Writeup/">Hitcon2021
Crypto Writeup</a> <a target="_blank" rel="noopener" href="https://lazzzaro.github.io/2020/05/07/crypto-%E7%A6%BB%E6%95%A3%E5%AF%B9%E6%95%B0/index.html">离散对数</a>
<a target="_blank" rel="noopener" href="https://dl.acm.org/doi/10.1145/335305.335337">Finding Smooth
Integers in Short Intervals Using CRT Decoding</a></p>
<h2 id="ezrsa">ezRSA++</h2>
<h3 id="problem-description-1">Problem description</h3>
<p>Based on 0CTF 2021 Finals "<a target="_blank" rel="noopener" href="https://github.com/M0urn3r/My-Public-CTF-Challenges#ezRSA+">ezRSA+</a>",
the intended solution is <em>"Partial Key Exposure Attack on Short
Secret Exponent CRT-RSA"</em>. Maybe the method in <em>"Small
CRT-exponent RSA revisited"</em> also works.</p>
<h4 id="code">code</h4>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> os <span class="keyword">import</span> urandom</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ExGCD</span>(<span class="params">a, b</span>):</span></span><br><span class="line">    <span class="keyword">if</span> <span class="number">0</span> == b:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>, <span class="number">0</span>, a</span><br><span class="line">    x, y, q = ExGCD(b, a % b)</span><br><span class="line">    x, y = y, (x - a // b * y)</span><br><span class="line">    <span class="keyword">return</span> x, y, q</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gen</span>(<span class="params">p_size, d_size, l_size</span>):</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        p = getPrime(p_size)</span><br><span class="line">        q = getPrime(p_size)</span><br><span class="line">        <span class="keyword">if</span> GCD(p - <span class="number">1</span>, q - <span class="number">1</span>) == <span class="number">2</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    d_p = getPrime(d_size)</span><br><span class="line">    d_q = getPrime(d_size)</span><br><span class="line">    s, t, g = ExGCD(p - <span class="number">1</span>, q - <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">if</span> s &lt; <span class="number">0</span>:</span><br><span class="line">        s += q - <span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        t += p - <span class="number">1</span></span><br><span class="line">    n = p * q</span><br><span class="line">    phi = (p - <span class="number">1</span>) * (q - <span class="number">1</span>)</span><br><span class="line">    e = (inverse(d_p, p - <span class="number">1</span>) * t * (q - <span class="number">1</span>) + inverse(d_q, q - <span class="number">1</span>)  * s * (p - <span class="number">1</span>)) // g % phi</span><br><span class="line">    <span class="keyword">assert</span> (e * d_q % (q - <span class="number">1</span>) == <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">assert</span> (e * d_p % (p - <span class="number">1</span>) == <span class="number">1</span>)</span><br><span class="line">    k = (e * d_p - <span class="number">1</span>) // (p - <span class="number">1</span>)</span><br><span class="line">    l = (e * d_q - <span class="number">1</span>) // (q - <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> (n, e), (d_p, d_q, p, q), (d_p % (<span class="number">2</span>**l_size), d_q % (<span class="number">2</span>**l_size))</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span>(<span class="params">m, pk</span>):</span></span><br><span class="line">    n, e = pk</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">pow</span>(m, e, n)</span><br><span class="line"></span><br><span class="line">p_size = <span class="number">1000</span></span><br><span class="line">d_size = <span class="number">105</span></span><br><span class="line">l_size = <span class="number">55</span></span><br><span class="line">pk, sk, hint = gen(p_size, d_size, l_size)</span><br><span class="line">flag = urandom(<span class="number">2</span> * p_size // <span class="number">8</span> - <span class="built_in">len</span>(flag) - <span class="number">1</span>) + flag</span><br><span class="line">enc = encrypt(<span class="built_in">int</span>(flag.<span class="built_in">hex</span>(), <span class="number">16</span>), pk)</span><br><span class="line">print(enc)</span><br><span class="line">print(pk)</span><br><span class="line">print(hint)</span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">35558284230663313298312684064040643811204702946900174110911295087662938676356112802781671547473910691476600838877279843972105403072929243674403244286458898562457747942651643439624568905004454158744508429126554955023110569348839934098381885098523538078300248638407684468503519326866276798222721018258242443186786917829878515320321445508466038372324063139762003962072922393974710763356236627711414307859950011736526834586028087922704589199885845050751932885698053938070734392371814246294798366452078193195538346218718588887085179856336533576097324041969786125752304133487678308830354729347735644474025828</span></span><br><span class="line"><span class="string">(44774502335951608354043148360684114092901940301155357314508676399067538307546121753785009844275454594381602690061553832466871574728524408152400619047820736137949166290404514747591817206669966103047443912935755873432503095952914080827536130899968275165557303493867755627520568588808534411526058896791373252974606364861105086430729757064078675811147972536205086402752245214343186536177015741922559575575911278873118556603923689408629477875537332177644886701517140711134017511229202430437068095342526435886609381176269251580339549071944830141516001532825295594908434587285225415103472279090325281062442217, 29624366183227462965645558392954094074485353876807451497147549927093025197118051280445930543762170853769573962200247669305286333212410439624262142109295839433584663989554419810341266820063074908743295553517790354149623873028162282751352613333181218478850463012413786673509078012976454604598813805735677104174112776060905225493357010861225261560490401501912259585922988353328944884443953564154752191932500561561256069872534626325000901099904014035414792860997025614313564862063784602254606240743545483125618939111639728114664995759380293512809125885893543730614962375399353971677980309835647540883700977)</span></span><br><span class="line"><span class="string">(5013415024346389, 4333469053087705)</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="solution-1">Solution</h3>
<h3 id="reference-1">Reference</h3>
<p>To be done... I'm too busy at this moment o((&gt;ω&lt; ))o</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/8/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><span class="page-number current">9</span><a class="page-number" href="/page/10/">10</a><span class="space">&hellip;</span><a class="page-number" href="/page/28/">28</a><a class="extend next" rel="next" href="/page/10/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>


<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Daisy</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a>
  </div>


  <script src='https://unpkg.com/mermaid@/dist/mermaid.min.js'></script>
  <script>
    if (window.mermaid) {
      mermaid.initialize({theme: 'forest'});
    }
  </script>

    </div>
  </footer>

  
  <script src="//cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/@next-theme/pjax@0.4.0/pjax.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script><script>
var pjax = new Pjax({
  selectors: [
    'head title',
    '.page-configurations',
    '.main-inner',
    '.post-toc-wrap',
    '.languages',
    '.pjax'
  ],
  analytics: false,
  cacheBust: false,
  scrollRestoration: false,
  scrollTo: !CONFIG.bookmark.enable
});

document.addEventListener('pjax:success', () => {
  pjax.executeScripts(document.querySelectorAll('script[data-pjax], .pjax script'));
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.subMenu)
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  const hasTOC = document.querySelector('.post-toc');
  document.querySelector('.sidebar-inner').classList.toggle('sidebar-nav-active', hasTOC);
  document.querySelector(hasTOC ? '.sidebar-nav-toc' : '.sidebar-nav-overview').click();
  NexT.utils.updateSidebarPosition();
});
</script>


  





<script data-pjax>
if (document.querySelectorAll('.mermaid').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mermaid@8.8.3/dist/mermaid.min.js', () => {
    mermaid.init({
      theme    : 'dark',
      logLevel : 3,
      flowchart: { curve     : 'linear' },
      gantt    : { axisFormat: '%m/%d/%Y' },
      sequence : { actorMargin: 50 }
    }, '.mermaid');
  }, window.mermaid);
}
</script>


  




    <div class="pjax">

  <script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'none'
      },
      options: {
        renderActions: {
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              const target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    const script = document.createElement('script');
    script.src = '//cdn.jsdelivr.net/npm/mathjax@3.1.2/es5/tex-mml-chtml.js';
    script.defer = true;
    document.head.appendChild(script);
  } else {
    MathJax.startup.document.state(0);
    MathJax.typesetClear();
    MathJax.texReset();
    MathJax.typeset();
  }
</script>




    </div>
</body>
</html>
